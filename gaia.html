<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gaia random</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,600" rel="stylesheet">
    <style>
        body {
            width: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
        }

        .background-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            height: auto;
            margin: 0 auto;
        }

        .background-container img {
            width: 100%;
            height: auto;
            display: block;
        }

        .overlay-image-01 {
            position: absolute;
            top: 29%;
            left: 75%;
            max-width: 63px;
        }

        .overlay-image-02 {
            position: absolute;
            top: 25%;
            left: 74%;
            max-width: 65px;
        }

        .overlay-image-03 {
            position: absolute;
            top: 14%;
            left: 71%;
            max-width: 68px;
        }

        .overlay-image-federation {
            position: absolute;
            top: 52%;
            left: 64%;
            max-width: 37px;
        }

        .overlay-image-federation-02 {
            position: absolute;
            top: 58%;
            left: 65%;
            max-width: 35px;
        }

        .overlay-image-federation-04 {
            position: absolute;
            top: 62%;
            left: 57%;
            max-width: 35px;
        }

        .overlay-image-art-0 {
            position: absolute;
            top: 10%;
            left: 69%;
            max-width: 50px;
        }

        .overlay-image-art-1 {
            position: absolute;
            top: 10%;
            left: 86%;
            max-width: 50px;
        }

        .overlay-image-art-2 {
            position: absolute;
            top: 60%;
            left: 69%;
            max-width: 50px;
        }

        .overlay-image-art-3 {
            position: absolute;
            top: 60%;
            left: 86%;
            max-width: 50px;
        }

        .overlay-image-coring {
            position: absolute;
            top: 34%;
            left: 33%;
            max-width: 78px;
        }

        .content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .federation,
        .images {
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        td {
            padding: 5px;
            text-align: center;
        }

        .form-center {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .form-center label {
            margin-right: 15px;
            cursor: pointer;
        }

        .submit-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .submit-button:hover {
            background-color: #45a049;
        }

        .rights {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .hidden {
            display: none;
        }

        /* 优化的圆形区域样式 */
        .circular-section {
            display: flex;
            justify-content: center;
            width: 100%;
            margin: 20px 0;
        }

        .circular-container-wrapper {
            position: relative;
            width: 100%;
            max-width: 650px;
            margin: 0 auto;
        }

        .circular-container {
            position: relative;
            width: 400px;
            height: 220px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .circular-container {
                transform: scale(0.85);
                transform-origin: left;
            }
        }

        /* 科技板块B区域样式调整 - 确保第二行正确三等分 */
        #techTileBSection table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        #techTileBRow1 td,
        #techTileBRow2 td {
            padding: 5px;
            text-align: center;
            vertical-align: top;
        }

        #techTileBRow1 td {
            width: 16.666%; /* 第一行6个元素均分 */
        }

        #techTileBRow2 td {
            width: 33.333%; /* 第二行3个元素均分 */
        }

        #techTileBRow1 img,
        #techTileBRow2 img {
            max-width: 100px;
            height: auto;
            width: 100%;
            display: block;
            margin: 0 auto;
        }

        /* 第二行图片特定偏移 */
        #techTileBRow2 td:nth-child(1) img {
            transform: translateX(70%); /* 第一张图片向右偏移半张图片长度 */
        }

        #techTileBRow2 td:nth-child(2) img {
            transform: translateX(190%); /* 第二张图片向右偏移一张图片长度 */
        }

        #techTileBRow2 td:nth-child(3) img {
            transform: translateX(310%); /* 第三张图片向右偏移一张图片长度，向下偏移一张图片高度 */
        }

        /*@media (max-width: 480px) {*/
        /*    .circular-container {*/
        /*        transform: scale(0.7);*/
        /*        transform-origin: center top;*/
        /*    }*/
        /*}*/
    </style>
</head>
<body>
<div class="content">
    <!-- 种族区域 -->
    <div class="federation" id="federationSection">
        <table>
            <tr>
                <td><img id="federationImg" src="" style="max-width:100px; height:auto;width:100%;"></td>
                <td id="factionContainer"></td>
            </tr>
        </table>
    </div>

    <!-- 科技板块A区域 -->
    <div class="images" id="techTileASection">
        <table>
            <tr id="techTileARow"></tr>
        </table>
    </div>

    <!-- 科技板块B区域 -->
    <div class="images" id="techTileBSection">
        <table>
            <tr id="techTileBRow1"></tr>
            <tr id="techTileBRow2"></tr>
        </table>
    </div>

    <!-- Lost Fleet扩展区域 -->
    <div class="images hidden" id="lostFleetSection">
        <!-- Brown Board -->
        <table id="brownBoardTable" class="hidden">
            <tr>
                <td colspan="6">
                    <div class="background-container">
                        <img src="doc/gaia/LFBoard_Brown.jpg" style="max-width:580px; height:auto;width:100%;" alt="Brown Board">
                        <img id="techTileLF0" class="overlay-image-01">
                        <img id="federationLostFleet0" class="overlay-image-federation">
                    </div>
                </td>
            </tr>
        </table>

        <!-- White Board -->
        <table>
            <tr>
                <td colspan="6">
                    <div class="background-container">
                        <img src="doc/gaia/LFBoard_White.jpg" style="max-width:580px; height:auto;width:100%;" alt="White Board">
                        <img id="techTileLF1" class="overlay-image-02">
                        <img id="federationLostFleet1" class="overlay-image-federation-02">
                    </div>
                </td>
            </tr>
        </table>

        <!-- Yellow Board -->
        <table>
            <tr>
                <td colspan="6">
                    <div class="background-container">
                        <img src="doc/gaia/LFBoard_Yellow.jpg" style="max-width:580px; height:auto;width:100%;" alt="Yellow Board">
                        <img id="techTileLF2" class="overlay-image-03">
                        <img id="federationLostFleet2" class="overlay-image-federation-02">
                    </div>
                </td>
            </tr>
        </table>

        <!-- Purple Board -->
        <table>
            <tr>
                <td colspan="6">
                    <div class="background-container">
                        <img src="doc/gaia/LFBoard_Purple.jpg" style="max-width:580px; height:auto;width:100%;" alt="Purple Board">
                        <img id="federationLostFleet3" class="overlay-image-federation-04">
                        <div id="artContainer"></div>
                    </div>
                </td>
            </tr>
        </table>

        <!-- Scoring Extension -->
        <table>
            <tr>
                <td colspan="6">
                    <div class="background-container">
                        <img id="lfScoringExtensionImg" style="max-width:300px; height:auto;width:100%;" alt="Scoring Extension">
                        <img id="coringImg" class="overlay-image-coring">
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <!-- Boost Tile区域 -->
    <div class="images" id="boostTileSection">
        <table>
            <tr id="boostTileRow"></tr>
        </table>
    </div>

    <!-- 优化后的圆形区域 -->
    <div class="images circular-section" id="circularSection">
        <div class="circular-container-wrapper">
            <div id="circularContainer" class="circular-container">
                <img id="rs0" style="transform: rotate(285deg); position: absolute; top: 104px; left: 17px; max-width:100px;">
                <img id="rs1" style="transform: rotate(315deg); position: absolute; top: 41px; left: 53px; max-width:100px;">
                <img id="rs2" style="transform: rotate(345deg); position: absolute; top: 4px; left: 116px; max-width:100px;">
                <img id="rs3" style="transform: rotate(15deg); position: absolute; top: 4px; left: 188px; max-width:100px;">
                <img id="rs4" style="transform: rotate(45deg); position: absolute; top: 41px; left: 250px; max-width:100px;">
                <img id="rs5" style="transform: rotate(75deg); position: absolute; top: 104px; left: 285px; max-width:100px;">
                <img id="egs0" style="position: absolute; top: 0px; left: 0px; max-width:74px; height:auto;">
                <img id="egs1" style="position: absolute; top: 0px; right: 0px; max-width:74px; height:auto;">
            </div>
        </div>
    </div>
</div>

<!-- 表单 -->
<form class="form-center" id="gameForm">
    <div>
        <label>
            <input type="radio" name="player" value="2"> 2 Player
        </label>
        <label>
            <input type="radio" name="player" value="3"> 3 Player
        </label>
        <label>
            <input type="radio" name="player" value="4" checked> 4 Player
        </label>
    </div>
    <br>
    <div>
        <label>
            <input type="radio" name="lost_fleet" value="0"> 不加入扩展
        </label>
        <label>
            <input type="radio" name="lost_fleet" value="1" checked> 加入扩展
        </label>
    </div>
    <br>
    <div style="display: flex; justify-content: center;">
        <button type="submit" class="submit-button">提交</button>
    </div>
</form>

<p class="rights">Copyright &copy; 2024-2030 levy伟健 版权所有</p>

<script>
    class GameController {
        constructor() {
            this.factions = ['FB', 'GB', 'HI', 'IN', 'TA', 'TL', 'XG'];
            this.lostFleetFaction = ['DT', 'MS'];
            this.surfaces = ['A', 'B'];
        }

        gaiaRandom(request) {
            const player = request.get('player', 4);
            const lostFleet = request.get('lost_fleet', 0);

            const faction = this.getFaction(player, lostFleet);
            let techTileA = this.getTechTileA(lostFleet);
            const coring = techTileA.pop();
            const techTileB = this.getTechTileB(lostFleet);
            const techTileLF = this.getTechTileLF();
            const boostTile = this.getBoostTile(player, lostFleet);
            const egs = this.getEgs(lostFleet);
            const federation = this.getFederation(0);
            const federationLostFleet = this.getFederation(1);
            const rs = this.getRs(lostFleet);
            const art = this.getArt(player);

            return {
                faction: faction,
                tech_tile_a: techTileA,
                coring: coring,
                tech_tile_b: techTileB,
                tech_tile_lf: techTileLF,
                boost_tile: boostTile,
                egs: egs,
                federation: federation,
                federation_lost_fleet: federationLostFleet,
                rs: rs,
                art: art,
                player: player,
                lost_fleet: lostFleet,
                lfScoringExtension: player > 2 ? 'LFScoringExtension34.jpg' : 'LFScoringExtension12.jpg'
            };
        }

        getFaction(player, lostFleet) {
            let factions = [...this.factions];
            if (lostFleet) {
                factions = factions.concat(this.lostFleetFaction);
            }

            const playerFa = this.getRandomElements(factions, player);
            return playerFa.map(value =>
                `Faction_${value}_${this.getRandomElements(this.surfaces, 1)[0]}.jpg`
            );
        }

        getTechTileA(lostFleet) {
            let techTile = Array.from({ length: 15 }, (_, i) => i + 1);
            if (lostFleet) {
                const lostFleetTechTile = Array.from({ length: 6 }, (_, i) => i + 16);
                techTile = techTile.concat(lostFleetTechTile);
            }

            const data = this.getRandomElements(techTile, 7);
            return data.map(value => `TechTile_A${value}.jpg`);
        }

        getTechTileB(lostFleet) {
            let techTile = Array.from({ length: 9 }, (_, i) => i + 1);
            const lostFleetTechTile = '3LF';

            if (lostFleet) {
                techTile.push(lostFleetTechTile);
                techTile = techTile.filter(item => item !== 3);
            }

            const data = this.getRandomElements(techTile, 9);
            return data.map(value => `TechTile_B${value}.jpg`);
        }

        getTechTileLF() {
            const techTile = [10, 11, 12];
            const data = this.getRandomElements(techTile, 3);
            return data.map(value => `TechTile_B${value}.jpg`);
        }

        getBoostTile(player, lostFleet) {
            let tile = Array.from({ length: 10 }, (_, i) => i + 1);
            if (lostFleet) {
                const lostFleetTile = Array.from({ length: 4 }, (_, i) => i + 11);
                tile = tile.concat(lostFleetTile);
            }

            const data = this.getRandomElements(tile, player + 3);
            return data.map(value => `BoostTile_${value}.jpg`);
        }

        getEgs(lostFleet) {
            let tile = Array.from({ length: 6 }, (_, i) => i + 1);
            if (lostFleet) {
                const lostFleetTile = Array.from({ length: 3 }, (_, i) => i + 7);
                tile = tile.concat(lostFleetTile);
            }

            const data = this.getRandomElements(tile, 2);
            return data.map(value => `EGS_${value}.jpg`);
        }

        getFederation(lostFleet) {
            let count = 1;
            let tile;

            if (lostFleet) {
                tile = Array.from({ length: 8 }, (_, i) => i + 7);
                count = 4;
            } else {
                tile = Array.from({ length: 6 }, (_, i) => i + 1);
            }

            const data = this.getRandomElements(tile, count);
            return data.map(value => `Federation_${value}.gif`);
        }

        getRs(lostFleet) {
            let tile = Array.from({ length: 10 }, (_, i) => i + 1);
            if (lostFleet) {
                const lostFleetTile = Array.from({ length: 3 }, (_, i) => i + 11);
                tile = tile.concat(lostFleetTile);
            }

            const data = this.getRandomElements(tile, 6);
            return data.map(value => `RS_${value}.gif`);
        }

        getArt(player) {
            const tile = Array.from({ length: 13 }, (_, i) => i + 1);
            const data = this.getRandomElements(tile, player);
            return data.map(value => `Art${value}.png`);
        }

        getRandomElements(array, count) {
            count = Math.min(count, array.length);
            const shuffled = [...array].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }
    }

    // 初始化游戏控制器
    const gameController = new GameController();

    // 页面加载完成后设置默认值
    document.addEventListener('DOMContentLoaded', function () {
        // 绑定表单提交事件
        document.getElementById('gameForm').addEventListener('submit', function (e) {
            e.preventDefault();
            generateGame();
        });

        // 首次生成游戏配置
        generateGame();
    });

    // 生成游戏配置并更新页面
    function generateGame() {
        // 获取表单数据
        const formData = new FormData(document.getElementById('gameForm'));
        const player = parseInt(formData.get('player')) || 4;
        const lostFleet = parseInt(formData.get('lost_fleet')) || 0;

        // 创建请求对象
        const request = {
            get: function (key, defaultValue) {
                if (key === 'player') return player;
                if (key === 'lost_fleet') return lostFleet;
                return defaultValue;
            }
        };

        // 生成游戏数据
        const gameData = gameController.gaiaRandom(request);

        // 更新页面显示
        updatePage(gameData);
    }

    // 根据游戏数据更新页面显示
    function updatePage(data) {
        // 更新种族区域
        document.getElementById('federationImg').src = `doc/gaia/${data.federation[0]}`;

        const factionContainer = document.getElementById('factionContainer');
        factionContainer.innerHTML = '';
        data.faction.forEach(faction => {
            const td = document.createElement('td');
            const img = document.createElement('img');
            img.src = `doc/gaia/${faction}`;
            img.style.cssText = 'max-width:200px; height:auto;width:100%;';
            td.appendChild(img);
            factionContainer.appendChild(td);
        });

        // 更新科技板块A
        const techTileARow = document.getElementById('techTileARow');
        techTileARow.innerHTML = '';
        data.tech_tile_a.forEach(tile => {
            const td = document.createElement('td');
            const img = document.createElement('img');
            img.src = `doc/gaia/${tile}`;
            img.style.cssText = 'max-width:100px; height:auto;width:100%;';
            td.appendChild(img);
            techTileARow.appendChild(td);
        });

        // 更新科技板块B
        const techTileBRow1 = document.getElementById('techTileBRow1');
        const techTileBRow2 = document.getElementById('techTileBRow2');
        techTileBRow1.innerHTML = '';
        techTileBRow2.innerHTML = '';

        data.tech_tile_b.forEach((tile, index) => {
            const td = document.createElement('td');
            const img = document.createElement('img');
            img.src = `doc/gaia/${tile}`;
            img.style.cssText = 'max-width:100px; height:auto;width:100%;';
            td.appendChild(img);

            // 前6个元素放在第一行
            if (index < 6) {
                techTileBRow1.appendChild(td);
            }
            // 后3个元素放在第二行
            else {
                techTileBRow2.appendChild(td);
            }
        });


        // 更新Lost Fleet扩展区域
        const lostFleetSection = document.getElementById('lostFleetSection');
        if (data.lost_fleet === 1) {
            lostFleetSection.classList.remove('hidden');

            // 更新Brown Board（仅当玩家数大于2时显示）
            const brownBoardTable = document.getElementById('brownBoardTable');
            if (data.player > 2) {
                brownBoardTable.classList.remove('hidden');
                document.getElementById('techTileLF0').src = `doc/gaia/${data.tech_tile_lf[0]}`;
                document.getElementById('federationLostFleet0').src = `doc/gaia/${data.federation_lost_fleet[0]}`;
            } else {
                brownBoardTable.classList.add('hidden');
            }

            // 更新其他Lost Fleet板子
            document.getElementById('techTileLF1').src = `doc/gaia/${data.tech_tile_lf[1]}`;
            document.getElementById('federationLostFleet1').src = `doc/gaia/${data.federation_lost_fleet[1]}`;
            document.getElementById('techTileLF2').src = `doc/gaia/${data.tech_tile_lf[2]}`;
            document.getElementById('federationLostFleet2').src = `doc/gaia/${data.federation_lost_fleet[2]}`;
            document.getElementById('federationLostFleet3').src = `doc/gaia/${data.federation_lost_fleet[3]}`;

            // 更新艺术卡
            const artContainer = document.getElementById('artContainer');
            artContainer.innerHTML = '';
            data.art.forEach((art, index) => {
                const img = document.createElement('img');
                img.src = `doc/gaia/${art}`;
                img.className = `overlay-image-art-${index}`;
                artContainer.appendChild(img);
            });

            // 更新评分扩展和coring
            document.getElementById('lfScoringExtensionImg').src = `doc/gaia/${data.lfScoringExtension}`;
            document.getElementById('coringImg').src = `doc/gaia/${data.coring}`;
        } else {
            lostFleetSection.classList.add('hidden');
        }

        // 更新Boost Tile
        const boostTileRow = document.getElementById('boostTileRow');
        boostTileRow.innerHTML = '';
        data.boost_tile.forEach(boost => {
            const td = document.createElement('td');
            const img = document.createElement('img');
            img.src = `doc/gaia/${boost}`;
            img.style.cssText = 'max-height:130px; width:auto;height:100%;';
            td.appendChild(img);
            boostTileRow.appendChild(td);
        });

        // 更新圆形区域
        document.getElementById('rs0').src = `doc/gaia/${data.rs[0]}`;
        document.getElementById('rs1').src = `doc/gaia/${data.rs[1]}`;
        document.getElementById('rs2').src = `doc/gaia/${data.rs[2]}`;
        document.getElementById('rs3').src = `doc/gaia/${data.rs[3]}`;
        document.getElementById('rs4').src = `doc/gaia/${data.rs[4]}`;
        document.getElementById('rs5').src = `doc/gaia/${data.rs[5]}`;
        document.getElementById('egs0').src = `doc/gaia/${data.egs[0]}`;
        document.getElementById('egs1').src = `doc/gaia/${data.egs[1]}`;
    }
</script>
</body>
</html>
