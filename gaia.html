<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gaia random</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,600" rel="stylesheet">
    <style>
        body {
            width: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
        }

        .background-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            height: auto;
            margin: 0 auto;
        }

        .background-container img {
            width: 100%;
            height: auto;
            display: block;
        }

        .overlay-image-01 {
            position: absolute;
            top: 29%;
            left: 75%;
            max-width: 63px;
        }

        .overlay-image-02 {
            position: absolute;
            top: 25%;
            left: 74%;
            max-width: 65px;
        }

        .overlay-image-03 {
            position: absolute;
            top: 14%;
            left: 71%;
            max-width: 68px;
        }

        .overlay-image-federation {
            position: absolute;
            top: 52%;
            left: 64%;
            max-width: 37px;
        }

        .overlay-image-federation-02 {
            position: absolute;
            top: 58%;
            left: 65%;
            max-width: 35px;
        }

        .overlay-image-federation-04 {
            position: absolute;
            top: 62%;
            left: 57%;
            max-width: 35px;
        }

        .overlay-image-art-0 {
            position: absolute;
            top: 10%;
            left: 69%;
            max-width: 50px;
        }

        .overlay-image-art-1 {
            position: absolute;
            top: 10%;
            left: 86%;
            max-width: 50px;
        }

        .overlay-image-art-2 {
            position: absolute;
            top: 60%;
            left: 69%;
            max-width: 50px;
        }

        .overlay-image-art-3 {
            position: absolute;
            top: 60%;
            left: 86%;
            max-width: 50px;
        }

        .overlay-image-coring {
            position: absolute;
            top: 34%;
            left: 31%;
            max-width: 78px;
        }

        .content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
        }

        .federation,
        .images {
            margin-bottom: 1px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        td {
            padding: 1px;
            text-align: center;
        }

        .form-center {
            max-width: 600px;
            margin: 10px auto;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-center label {
            margin-right: 15px;
            cursor: pointer;
        }

        .submit-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .submit-button:hover {
            background-color: #45a049;
        }

        .rights {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .hidden {
            display: none;
        }

        /* ä¼˜åŒ–çš„åœ†å½¢åŒºåŸŸæ ·å¼ */
        .circular-section {
            display: flex;
            justify-content: center;
            width: 100%;
            margin: 10px 0;
        }

        .circular-container-wrapper {
            position: relative;
            width: 100%;
            max-width: 650px;
            margin: 0 auto;
        }

        .circular-container {
            position: relative;
            width: 400px;
            height: 220px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .circular-container {
                transform: scale(0.85);
                transform-origin: left;
            }
        }

        /* ç§‘æŠ€æ¿å—BåŒºåŸŸæ ·å¼è°ƒæ•´ - ç¡®ä¿ç¬¬äºŒè¡Œæ­£ç¡®ä¸‰ç­‰åˆ† */
        #techTileBSection table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        #techTileBRow1 td,
        #techTileBRow2 td {
            padding: 5px;
            text-align: center;
            vertical-align: top;
        }

        #techTileBRow1 td {
            width: 16.666%; /* ç¬¬ä¸€è¡Œ6ä¸ªå…ƒç´ å‡åˆ† */
        }

        #techTileBRow2 td {
            width: 33.333%; /* ç¬¬äºŒè¡Œ3ä¸ªå…ƒç´ å‡åˆ† */
        }

        #techTileBRow1 img,
        #techTileBRow2 img {
            max-width: 100px;
            height: auto;
            width: 100%;
            display: block;
            margin: 0 auto;
        }

        /* ç¬¬äºŒè¡Œå›¾ç‰‡ç‰¹å®šåç§» */
        #techTileBRow2 td:nth-child(1) img {
            transform: translateX(70%); /* ç¬¬ä¸€å¼ å›¾ç‰‡å‘å³åç§»åŠå¼ å›¾ç‰‡é•¿åº¦ */
        }

        #techTileBRow2 td:nth-child(2) img {
            transform: translateX(190%); /* ç¬¬äºŒå¼ å›¾ç‰‡å‘å³åç§»ä¸€å¼ å›¾ç‰‡é•¿åº¦ */
        }

        #techTileBRow2 td:nth-child(3) img {
            transform: translateX(310%); /* ç¬¬ä¸‰å¼ å›¾ç‰‡å‘å³åç§»ä¸€å¼ å›¾ç‰‡é•¿åº¦ï¼Œå‘ä¸‹åç§»ä¸€å¼ å›¾ç‰‡é«˜åº¦ */
        }

        /* æ·»åŠ åˆ°ç°æœ‰æ ·å¼ä¸­ */
        #generateImageButton {
            background-color: #2196F3;
            margin-top: 10px;
        }

        #generateImageButton:hover {
            background-color: #0b7dda;
        }

        .submit-button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px; /* å‡å°å†…è¾¹è· */
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px; /* å‡å°å­—ä½“å¤§å° */
        }

        .submit-button:hover {
            background-color: #45a049;
        }

        .circular-container {
            position: relative;
            width: 400px;
            /*height: 270px; !* å¢åŠ é«˜åº¦ä»¥å®¹çº³éª°å­æŒ‰é’® *!*/
            margin: 0 auto;
        }

        /*@media (max-width: 480px) {*/
        /*    .circular-container {*/
        /*        transform: scale(0.7);*/
        /*        transform-origin: center top;*/
        /*    }*/
        /*}*/
    </style>
</head>
<body>
<div class="content">
    <!-- ç§æ—åŒºåŸŸ -->
    <div class="federation" id="federationSection">
        <table>
            <tr>
                <td><img id="federationImg" src="" style="max-width:100px; height:auto;width:100%;"></td>
                <td id="factionContainer"></td>
            </tr>
        </table>
    </div>

    <!-- ç§‘æŠ€æ¿å—AåŒºåŸŸ -->
    <div class="images" id="techTileASection">
        <table>
            <tr id="techTileARow"></tr>
        </table>
    </div>

    <!-- åœ¨ç§‘æŠ€æ¿å—BåŒºåŸŸä¸Šæ–¹æ·»åŠ ç§‘æŠ€æ¿å—CåŒºåŸŸ -->
    <div class="images hidden" id="techTileCSection">
        <table>
            <tr id="techTileCRow"></tr>
        </table>
    </div>

    <!-- ç§‘æŠ€æ¿å—BåŒºåŸŸ -->
    <div class="images" id="techTileBSection">
        <table>
            <tr id="techTileBRow1"></tr>
            <tr id="techTileBRow2"></tr>
        </table>
    </div>

    <!-- Lost Fleetæ‰©å±•åŒºåŸŸ -->
    <div class="images hidden" id="lostFleetSection">
        <!-- Brown Board -->
        <table id="brownBoardTable" class="hidden">
            <tr>
                <td colspan="6">
                    <div class="background-container">
                        <img src="doc/gaia/LFBoard_Brown.jpg" style="max-width:580px; height:auto;width:100%;" alt="Brown Board">
                        <img id="techTileLF0" class="overlay-image-01">
                        <img id="federationLostFleet0" class="overlay-image-federation">
                    </div>
                </td>
            </tr>
        </table>

        <!-- White Board -->
        <table>
            <tr>
                <td colspan="6">
                    <div class="background-container">
                        <img src="doc/gaia/LFBoard_White.jpg" style="max-width:580px; height:auto;width:100%;" alt="White Board">
                        <img id="techTileLF1" class="overlay-image-02">
                        <img id="federationLostFleet1" class="overlay-image-federation-02">
                    </div>
                </td>
            </tr>
        </table>

        <!-- Yellow Board -->
        <table>
            <tr>
                <td colspan="6">
                    <div class="background-container">
                        <img src="doc/gaia/LFBoard_Yellow.jpg" style="max-width:580px; height:auto;width:100%;" alt="Yellow Board">
                        <img id="techTileLF2" class="overlay-image-03">
                        <img id="federationLostFleet2" class="overlay-image-federation-02">
                    </div>
                </td>
            </tr>
        </table>

        <!-- Purple Board -->
        <table>
            <tr>
                <td colspan="6">
                    <div class="background-container">
                        <img src="doc/gaia/LFBoard_Purple.jpg" style="max-width:580px; height:auto;width:100%;" alt="Purple Board">
                        <img id="federationLostFleet3" class="overlay-image-federation-04">
                        <div id="artContainer"></div>
                    </div>
                </td>
            </tr>
        </table>

        <!-- Scoring Extension -->
        <table>
            <tr>
                <td colspan="6">
                    <div class="background-container">
                        <img id="lfScoringExtensionImg" style="max-width:300px; height:auto;width:100%;" alt="Scoring Extension">
                        <img id="coringImg" class="overlay-image-coring">
                        <img id="researchImg" style="max-width: 65px;height:auto;position: absolute;top: 1px;left;right: 1px;">
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <!-- Boost TileåŒºåŸŸ -->
    <div class="images" id="boostTileSection">
        <table>
            <tr id="boostTileRow"></tr>
        </table>
    </div>

    <!-- ä¼˜åŒ–åçš„åœ†å½¢åŒºåŸŸ -->
    <div class="images circular-section" id="circularSection">
        <div class="circular-container-wrapper">
            <div id="circularContainer" class="circular-container">
                <img id="rs0" style="transform: rotate(285deg); position: absolute; top: 104px; left: 17px; max-width:100px;">
                <img id="rs1" style="transform: rotate(315deg); position: absolute; top: 41px; left: 53px; max-width:100px;">
                <img id="rs2" style="transform: rotate(345deg); position: absolute; top: 4px; left: 116px; max-width:100px;">
                <img id="rs3" style="transform: rotate(15deg); position: absolute; top: 4px; left: 188px; max-width:100px;">
                <img id="rs4" style="transform: rotate(45deg); position: absolute; top: 41px; left: 250px; max-width:100px;">
                <img id="rs5" style="transform: rotate(75deg); position: absolute; top: 104px; left: 285px; max-width:100px;">
                <img id="egs0" style="position: absolute; top: 0px; left: 0px; max-width:74px; height:auto;">
                <img id="egs1" style="position: absolute; top: 0px; right: 0px; max-width:74px; height:auto;">
                <!-- æ·»åŠ éª°å­æŒ‰é’® -->
                <button type="submit" id="diceButton" style="
                    position: absolute;
                    bottom: 10px;
                    left: 50%;
                    transform: translateX(-50%);
                    width: 50px;
                    height: 50px;
                    border-radius: 50%;
                    background-color: #8a6835;
                    border: none;
                    cursor: pointer;
                    font-size: 24px;
                    color: white;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                ">ğŸ²</button>
            </div>
        </div>
    </div>
</div>
<!-- è¡¨å• -->
<form class="form-center" id="gameForm">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
        <div style="display: flex; align-items: center; margin-right: 20px;">
            <span style="margin-right: 10px;">ç©å®¶æ•°:</span>
            <label style="margin-right: 10px;">
                <input type="radio" name="player" value="2"> 2äºº
            </label>
            <label style="margin-right: 10px;">
                <input type="radio" name="player" value="3"> 3äºº
            </label>
            <label>
                <input type="radio" name="player" value="4" checked> 4äºº
            </label>
        </div>
        <div style="display: flex; align-items: center;">
            <span style="margin-right: 10px;">æ‰©å±•:</span>
            <label style="margin-right: 10px;">
                <input type="radio" name="lost_fleet" value="0"> ä¸åŠ å…¥
            </label>
            <label>
                <input type="radio" name="lost_fleet" value="1" checked> åŠ å…¥
            </label>
        </div>
    </div>
    <br>
    <!--    <div style="display: flex; justify-content: center;">-->
    <!--        <button type="submit" class="submit-button">æäº¤</button>-->
    <!--    </div>-->
</form>

<!-- åœ¨è¡¨å•ä¸‹æ–¹æ·»åŠ ç”Ÿæˆå›¾ç‰‡æŒ‰é’® -->
<form class="form-center" id="gameForm">
    <!-- ç°æœ‰è¡¨å•å†…å®¹ -->
    <div style="display: flex; justify-content: center; margin-top: 10px;">
        <button type="button" id="generateImageButton" class="submit-button">ç”Ÿæˆåˆ†äº«å›¾ç‰‡</button>
    </div>
</form>

<!-- æ·»åŠ æ¨¡æ€æ¡†ç”¨äºæ˜¾ç¤ºç”Ÿæˆçš„å›¾ç‰‡ -->
<div id="imageModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8);">
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
        <span id="closeModal" style="position: absolute; top: 20px; right: 30px; color: white; font-size: 35px; font-weight: bold; cursor: pointer;">&times;</span>
        <img id="generatedImage" style="max-width: 90%; max-height: 80%; margin-bottom: 20px;">
        <button id="downloadImage" class="submit-button">ä¸‹è½½å›¾ç‰‡ï¼ˆå¯é•¿æŒ‰å›¾ç‰‡ä¿å­˜ï¼‰</button>
    </div>
</div>

<script>
    class GameController {
        constructor() {
            this.factions = ['FB', 'GB', 'HI', 'IN', 'TA', 'TL', 'XG'];
            this.lostFleetFaction = ['DT', 'MS'];
            this.surfaces = ['A', 'B'];
        }

        gaiaRandom(request) {
            const player = request.get('player', 4);
            const lostFleet = request.get('lost_fleet', 0);

            const faction = this.getFaction(player, lostFleet);
            let techTileA = this.getTechTileA(lostFleet);
            const coring = techTileA.pop();
            const techTileB = this.getTechTileB(lostFleet);
            const techTileLF = this.getTechTileLF();
            const boostTile = this.getBoostTile(player, lostFleet);
            const egs = this.getEgs(lostFleet);
            const federation = this.getFederation(0);
            const federationLostFleet = this.getFederation(1);
            const rs = this.getRs(lostFleet);
            const art = this.getArt(player);

            return {
                faction: faction,
                tech_tile_a: techTileA,
                coring: coring,
                tech_tile_b: techTileB,
                tech_tile_lf: techTileLF,
                boost_tile: boostTile,
                egs: egs,
                federation: federation,
                federation_lost_fleet: federationLostFleet,
                rs: rs,
                art: art,
                player: player,
                lost_fleet: lostFleet,
                lfScoringExtension: player > 2 ?
                    (Math.random() > 0.5 ? 'LFScoringExtension34.jpg' : 'LFScoringExtension12.jpg') :
                    'LFScoringExtension12.jpg'
            };
        }

        getFaction(player, lostFleet) {
            let factions = [...this.factions];
            if (lostFleet) {
                factions = factions.concat(this.lostFleetFaction);
            }

            const playerFa = this.getRandomElements(factions, player);
            return playerFa.map(value =>
                `Faction_${value}_${this.getRandomElements(this.surfaces, 1)[0]}.jpg`
            );
        }

        getTechTileA(lostFleet) {
            let techTile = Array.from({ length: 15 }, (_, i) => i + 1);
            if (lostFleet) {
                const lostFleetTechTile = Array.from({ length: 6 }, (_, i) => i + 16);
                techTile = techTile.concat(lostFleetTechTile);
            }

            const data = this.getRandomElements(techTile, 7);
            return data.map(value => `TechTile_A${value}.jpg`);
        }

        getTechTileB(lostFleet) {
            let techTile = Array.from({ length: 9 }, (_, i) => i + 1);
            const lostFleetTechTile = '3LF';

            if (lostFleet) {
                techTile.push(lostFleetTechTile);
                techTile = techTile.filter(item => item !== 3);
            }

            const data = this.getRandomElements(techTile, 9);
            return data.map(value => `TechTile_B${value}.jpg`);
        }

        getTechTileLF() {
            const techTile = [10, 11, 12];
            const data = this.getRandomElements(techTile, 3);
            return data.map(value => `TechTile_B${value}.jpg`);
        }

        getBoostTile(player, lostFleet) {
            let tile = Array.from({ length: 10 }, (_, i) => i + 1);
            if (lostFleet) {
                const lostFleetTile = Array.from({ length: 4 }, (_, i) => i + 11);
                tile = tile.concat(lostFleetTile);
            }

            const data = this.getRandomElements(tile, player + 3);
            return data.map(value => `BoostTile_${value}.jpg`);
        }

        getEgs(lostFleet) {
            let tile = Array.from({ length: 6 }, (_, i) => i + 1);
            if (lostFleet) {
                const lostFleetTile = Array.from({ length: 3 }, (_, i) => i + 7);
                tile = tile.concat(lostFleetTile);
            }

            const data = this.getRandomElements(tile, 2);
            return data.map(value => `EGS_${value}.jpg`);
        }

        getFederation(lostFleet) {
            let count = 1;
            let tile;

            if (lostFleet) {
                tile = Array.from({ length: 8 }, (_, i) => i + 7);
                count = 4;
            } else {
                tile = Array.from({ length: 6 }, (_, i) => i + 1);
            }

            const data = this.getRandomElements(tile, count);
            return data.map(value => `Federation_${value}.gif`);
        }

        getRs(lostFleet) {
            let tile = Array.from({ length: 10 }, (_, i) => i + 1);
            if (lostFleet) {
                const lostFleetTile = Array.from({ length: 3 }, (_, i) => i + 11);
                tile = tile.concat(lostFleetTile);
            }

            const data = this.getRandomElements(tile, 6);
            return data.map(value => `RS_${value}.gif`);
        }

        getArt(player) {
            const tile = Array.from({ length: 13 }, (_, i) => i + 1);
            const data = this.getRandomElements(tile, player);
            return data.map(value => `Art${value}.png`);
        }

        getRandomElements(array, count) {
            count = Math.min(count, array.length);
            const shuffled = [...array].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }
    }

    // åˆå§‹åŒ–æ¸¸æˆæ§åˆ¶å™¨
    const gameController = new GameController();

    // é¡µé¢åŠ è½½å®Œæˆåè®¾ç½®é»˜è®¤å€¼
    document.addEventListener('DOMContentLoaded', function () {
        // ç»‘å®šè¡¨å•æäº¤äº‹ä»¶åˆ°æ–°çš„éª°å­æŒ‰é’®
        document.getElementById('diceButton').addEventListener('click', function (e) {
            e.preventDefault();
            generateGame();
        });

        // é¦–æ¬¡ç”Ÿæˆæ¸¸æˆé…ç½®
        generateGame();
    });

    // ç”Ÿæˆæ¸¸æˆé…ç½®å¹¶æ›´æ–°é¡µé¢
    function generateGame() {
        // è·å–è¡¨å•æ•°æ®
        const formData = new FormData(document.getElementById('gameForm'));
        const player = parseInt(formData.get('player')) || 4;
        const lostFleet = parseInt(formData.get('lost_fleet')) || 0;

        // åˆ›å»ºè¯·æ±‚å¯¹è±¡
        const request = {
            get: function (key, defaultValue) {
                if (key === 'player') return player;
                if (key === 'lost_fleet') return lostFleet;
                return defaultValue;
            }
        };

        // ç”Ÿæˆæ¸¸æˆæ•°æ®
        const gameData = gameController.gaiaRandom(request);

        // æ›´æ–°é¡µé¢æ˜¾ç¤º
        updatePage(gameData);
    }

    // æ ¹æ®æ¸¸æˆæ•°æ®æ›´æ–°é¡µé¢æ˜¾ç¤º
    function updatePage(data) {
        // æ›´æ–°ç§æ—åŒºåŸŸ
        document.getElementById('federationImg').src = `doc/gaia/${data.federation[0]}`;

        const factionContainer = document.getElementById('factionContainer');
        factionContainer.innerHTML = '';
        data.faction.forEach(faction => {
            const td = document.createElement('td');
            const img = document.createElement('img');
            img.src = `doc/gaia/${faction}`;
            img.style.cssText = 'max-width:200px; height:auto;width:100%;';
            td.appendChild(img);
            factionContainer.appendChild(td);
        });

        // æ›´æ–°ç§‘æŠ€æ¿å—A
        const techTileARow = document.getElementById('techTileARow');
        techTileARow.innerHTML = '';
        data.tech_tile_a.forEach(tile => {
            const td = document.createElement('td');
            const img = document.createElement('img');
            img.src = `doc/gaia/${tile}`;
            img.style.cssText = 'max-width:100px; height:auto;width:100%;';
            td.appendChild(img);
            techTileARow.appendChild(td);
        });

        // æ›´æ–°ç§‘æŠ€æ¿å—B
        const techTileBRow1 = document.getElementById('techTileBRow1');
        const techTileBRow2 = document.getElementById('techTileBRow2');
        techTileBRow1.innerHTML = '';
        techTileBRow2.innerHTML = '';

        data.tech_tile_b.forEach((tile, index) => {
            const td = document.createElement('td');
            const img = document.createElement('img');
            img.src = `doc/gaia/${tile}`;
            img.style.cssText = 'max-width:100px; height:auto;width:100%;';
            td.appendChild(img);

            // å‰6ä¸ªå…ƒç´ æ”¾åœ¨ç¬¬ä¸€è¡Œ
            if (index < 6) {
                techTileBRow1.appendChild(td);
            }
            // å3ä¸ªå…ƒç´ æ”¾åœ¨ç¬¬äºŒè¡Œ
            else {
                techTileBRow2.appendChild(td);
            }
        });

        // æ›´æ–°Lost Fleetæ‰©å±•åŒºåŸŸ
        const lostFleetSection = document.getElementById('lostFleetSection');
        if (data.lost_fleet === 1) {
            lostFleetSection.classList.remove('hidden');

            // æ›´æ–°Brown Boardï¼ˆä»…å½“ç©å®¶æ•°å¤§äº2æ—¶æ˜¾ç¤ºï¼‰
            const brownBoardTable = document.getElementById('brownBoardTable');
            if (data.player > 2) {
                brownBoardTable.classList.remove('hidden');
                document.getElementById('techTileLF0').src = `doc/gaia/${data.tech_tile_lf[0]}`;
                document.getElementById('federationLostFleet0').src = `doc/gaia/${data.federation_lost_fleet[0]}`;
            } else {
                brownBoardTable.classList.add('hidden');
            }

            // æ›´æ–°å…¶ä»–Lost Fleetæ¿å­
            document.getElementById('techTileLF1').src = `doc/gaia/${data.tech_tile_lf[1]}`;
            document.getElementById('federationLostFleet1').src = `doc/gaia/${data.federation_lost_fleet[1]}`;
            document.getElementById('techTileLF2').src = `doc/gaia/${data.tech_tile_lf[2]}`;
            document.getElementById('federationLostFleet2').src = `doc/gaia/${data.federation_lost_fleet[2]}`;
            document.getElementById('federationLostFleet3').src = `doc/gaia/${data.federation_lost_fleet[3]}`;

            // æ›´æ–°è‰ºæœ¯å¡
            const artContainer = document.getElementById('artContainer');
            artContainer.innerHTML = '';
            data.art.forEach((art, index) => {
                const img = document.createElement('img');
                img.src = `doc/gaia/${art}`;
                img.className = `overlay-image-art-${index}`;
                artContainer.appendChild(img);
            });

            const researchImg = Math.random() > 0.5 ? 'EconomicResearch_A.jpg' : 'EconomicResearch_B.jpg';


            // æ›´æ–°è¯„åˆ†æ‰©å±•å’Œcoring
            document.getElementById('lfScoringExtensionImg').src = `doc/gaia/${data.lfScoringExtension}`;
            document.getElementById('coringImg').src = `doc/gaia/${data.coring}`;
            document.getElementById('researchImg').src = `doc/gaia/${researchImg}`;
        } else {
            lostFleetSection.classList.add('hidden');
        }

        // æ›´æ–°Boost Tile
        const boostTileRow = document.getElementById('boostTileRow');
        boostTileRow.innerHTML = '';
        data.boost_tile.forEach(boost => {
            const td = document.createElement('td');
            const img = document.createElement('img');
            img.src = `doc/gaia/${boost}`;
            img.style.cssText = 'max-height:130px; width:auto;height:100%;';
            td.appendChild(img);
            boostTileRow.appendChild(td);
        });

        // æ›´æ–°åœ†å½¢åŒºåŸŸ
        document.getElementById('rs0').src = `doc/gaia/${data.rs[0]}`;
        document.getElementById('rs1').src = `doc/gaia/${data.rs[1]}`;
        document.getElementById('rs2').src = `doc/gaia/${data.rs[2]}`;
        document.getElementById('rs3').src = `doc/gaia/${data.rs[3]}`;
        document.getElementById('rs4').src = `doc/gaia/${data.rs[4]}`;
        document.getElementById('rs5').src = `doc/gaia/${data.rs[5]}`;
        document.getElementById('egs0').src = `doc/gaia/${data.egs[0]}`;
        document.getElementById('egs1').src = `doc/gaia/${data.egs[1]}`;
    }

    // ç”Ÿæˆåˆ†äº«å›¾ç‰‡åŠŸèƒ½
    document.addEventListener('DOMContentLoaded', function() {
        // ç»‘å®šç”Ÿæˆå›¾ç‰‡æŒ‰é’®äº‹ä»¶
        document.getElementById('generateImageButton').addEventListener('click', generateShareImage);

        // ç»‘å®šå…³é—­æ¨¡æ€æ¡†äº‹ä»¶
        document.getElementById('closeModal').addEventListener('click', function() {
            document.getElementById('imageModal').style.display = 'none';
        });

        // ç»‘å®šä¸‹è½½å›¾ç‰‡äº‹ä»¶
        document.getElementById('downloadImage').addEventListener('click', downloadImage);

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.style.display = 'none';
            }
        });
    });

    // ç”Ÿæˆåˆ†äº«å›¾ç‰‡
    function generateShareImage() {
        // æ˜¾ç¤ºåŠ è½½æç¤º
        const modal = document.getElementById('imageModal');
        const imageElement = document.getElementById('generatedImage');
        imageElement.src = '';
        imageElement.alt = 'æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...';
        modal.style.display = 'block';

        // ä½¿ç”¨html2canvasç”Ÿæˆå›¾ç‰‡
        import('https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js').then(() => {
            const contentElement = document.querySelector('.content');

            html2canvas(contentElement, {
                scale: 2, // æé«˜å›¾ç‰‡è´¨é‡
                useCORS: true,
                backgroundColor: '#fff'
            }).then(canvas => {
                // å°†canvasè½¬æ¢ä¸ºå›¾ç‰‡
                const imageData = canvas.toDataURL('image/png');
                imageElement.src = imageData;
                imageElement.alt = 'ç›–äºšéšæœºç»“æœ';
            }).catch(error => {
                console.error('ç”Ÿæˆå›¾ç‰‡å¤±è´¥:', error);
                imageElement.alt = 'ç”Ÿæˆå›¾ç‰‡å¤±è´¥';
            });
        }).catch(error => {
            console.error('åŠ è½½html2canvaså¤±è´¥:', error);
            imageElement.alt = 'åŠ è½½å›¾ç‰‡ç”Ÿæˆå·¥å…·å¤±è´¥';
        });
    }

    // ä¸‹è½½å›¾ç‰‡
    function downloadImage() {
        const imageElement = document.getElementById('generatedImage');
        if (!imageElement.src) return;

        // ç”Ÿæˆæ–‡ä»¶å
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const timestamp = `${year}${month}${day}${hours}${minutes}${seconds}`;

        const filename = `ç›–äºšéšæœºç»“æœ_${year}${month}${day}_${timestamp}.png`;

        // åˆ›å»ºä¸‹è½½é“¾æ¥
        const link = document.createElement('a');
        link.href = imageElement.src;
        link.download = filename;

        // è§¦å‘ä¸‹è½½
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

</script>

<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?48d1a3725fd4ddb5c485a5d24702815d";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

</body>
</html>
